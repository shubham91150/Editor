<!DOCTYPE html>
<html lang="en">
<head>
ย ย <meta charset="UTF-8">
ย ย <meta name="viewport" content="width=device-width, initial-scale=1.0">
ย ย <title>Advanced QR Code Designer - Hindi Fixed</title>
ย ย <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
ย ย <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
ย ยย
ย ย <!-- QR Code Generation Library -->
ย ย <script src="https://cdn.jsdelivr.net/npm/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"ย
ย ย ย ย ย ย onerror="loadQRLibraryFallback()"></script>
ย ย <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>
ย ยย
ย ย <script>
ย ย ย ย let qrLibraryLoaded = false;
ย ย ย ยย
ย ย ย ย function loadQRLibraryFallback() {
ย ย ย ย ย ย const script = document.createElement('script');
ย ย ย ย ย ย script.src = 'https://unpkg.com/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js';
ย ย ย ย ย ย script.onload = () => {
ย ย ย ย ย ย ย ย qrLibraryLoaded = true;
ย ย ย ย ย ย ย ย updateLibraryStatus('โ QR Libraries loaded successfully', 'success');
ย ย ย ย ย ย };
ย ย ย ย ย ย script.onerror = () => {
ย ย ย ย ย ย ย ย updateLibraryStatus('โ Styling library failed - rounded patterns disabled', 'error');
ย ย ย ย ย ย };
ย ย ย ย ย ย document.head.appendChild(script);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย window.addEventListener('load', () => {
ย ย ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย ย ย if (typeof QRCodeStyling !== 'undefined') {
ย ย ย ย ย ย ย ย ย ย qrLibraryLoaded = true;
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย loadQRLibraryFallback();
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }, 100);
ย ย ย ย });
ย ย </script>
ย ย <style>
ย ย ย ย * {
ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย padding: 0;
ย ย ย ย ย ย box-sizing: border-box;
ย ย ย ย }

ย ย ย ย body {
ย ย ย ย ย ย font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
ย ย ย ย ย ย background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
ย ย ย ย ย ย min-height: 100vh;
ย ย ย ย ย ย padding: 20px;
ย ย ย ย }

ย ย ย ย .container {
ย ย ย ย ย ย max-width: 1200px;
ย ย ย ย ย ย margin: 0 auto;
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย border-radius: 20px;
ย ย ย ย ย ย box-shadow: 0 20px 40px rgba(0,0,0,0.1);
ย ย ย ย ย ย overflow: hidden;
ย ย ย ย }

ย ย ย ย .header {
ย ย ย ย ย ย background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย padding: 30px;
ย ย ย ย ย ย text-align: center;
ย ย ย ย }

ย ย ย ย .header h1 {
ย ย ย ย ย ย font-size: 2.5em;
ย ย ย ย ย ย margin-bottom: 10px;
ย ย ย ย }

ย ย ย ย .header p {
ย ย ย ย ย ย opacity: 0.9;
ย ย ย ย ย ย font-size: 1.1em;
ย ย ย ย }

ย ย ย ย .main-content {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: 1fr 1fr;
ย ย ย ย ย ย gap: 40px;
ย ย ย ย ย ย padding: 40px;
ย ย ย ย }

ย ย ย ย .controls-panel {
ย ย ย ย ย ย background: #f8f9fa;
ย ย ย ย ย ย padding: 30px;
ย ย ย ย ย ย border-radius: 15px;
ย ย ย ย ย ย border: 1px solid #e9ecef;
ย ย ย ย }

ย ย ย ย .control-group {
ย ย ย ย ย ย margin-bottom: 25px;
ย ย ย ย }

ย ย ย ย .control-group label {
ย ย ย ย ย ย display: block;
ย ย ย ย ย ย margin-bottom: 8px;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย color: #495057;
ย ย ย ย }

ย ย ย ย .control-group input,
ย ย ย ย .control-group select,
ย ย ย ย .control-group textarea {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย padding: 12px;
ย ย ย ย ย ย border: 2px solid #e9ecef;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย font-size: 14px;
ย ย ย ย ย ย transition: border-color 0.3s ease;
ย ย ย ย }

ย ย ย ย .control-group input:focus,
ย ย ย ย .control-group select:focus,
ย ย ย ย .control-group textarea:focus {
ย ย ย ย ย ย outline: none;
ย ย ย ย ย ย border-color: #4facfe;
ย ย ย ย }

ย ย ย ย .color-controls {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: 1fr 1fr;
ย ย ย ย ย ย gap: 15px;
ย ย ย ย }

ย ย ย ย .style-selector {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: repeat(3, 1fr);
ย ย ย ย ย ย gap: 10px;
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย }

ย ย ย ย .style-option {
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย border: 2px solid #e9ecef;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย text-align: center;
ย ย ย ย ย ย transition: all 0.3s ease;
ย ย ย ย ย ย background: white;
ย ย ย ย }

ย ย ย ย .style-option.active {
ย ย ย ย ย ย border-color: #4facfe;
ย ย ย ย ย ย background: #f0f9ff;
ย ย ย ย }

ย ย ย ย .style-option:hover {
ย ย ย ย ย ย border-color: #4facfe;
ย ย ย ย ย ย transform: translateY(-2px);
ย ย ย ย }

ย ย ย ย .style-option.premium {
ย ย ย ย ย ย background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
ย ย ย ย ย ย color: #2d3436;
ย ย ย ย ย ย font-weight: bold;
ย ย ย ย }

ย ย ย ย .style-option.premium.active {
ย ย ย ย ย ย background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
ย ย ย ย }

ย ย ย ย .corner-styles {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: repeat(4, 1fr);
ย ย ย ย ย ย gap: 8px;
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย }

ย ย ย ย .corner-option {
ย ย ย ย ย ย width: 40px;
ย ย ย ย ย ย height: 40px;
ย ย ย ย ย ย border: 2px solid #e9ecef;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย transition: all 0.3s ease;
ย ย ย ย ย ย background: white;
ย ย ย ย }

ย ย ย ย .corner-option.active {
ย ย ย ย ย ย border-color: #4facfe;
ย ย ย ย ย ย background: #f0f9ff;
ย ย ย ย }

ย ย ย ย .preview-panel {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย ย ย align-items: center;
ย ย ย ย }

ย ย ย ย .qr-preview {
ย ย ย ย ย ย width: 400px;
ย ย ย ย ย ย height: 400px;
ย ย ย ย ย ย border: 2px solid #e9ecef;
ย ย ย ย ย ย border-radius: 15px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย background: white;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย ย ย box-shadow: 0 10px 30px rgba(0,0,0,0.1);
ย ย ย ย }

ย ย ย ย #qrCanvas {
ย ย ย ย ย ย max-width: 100%;
ย ย ย ย ย ย max-height: 100%;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย }

ย ย ย ย .export-controls {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: repeat(2, 1fr);
ย ย ย ย ย ย gap: 15px;
ย ย ย ย ย ย width: 100%;
ย ย ย ย }

ย ย ย ย .btn {
ย ย ย ย ย ย background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย padding: 15px 25px;
ย ย ย ย ย ย border-radius: 10px;
ย ย ย ย ย ย font-size: 16px;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย transition: all 0.3s ease;
ย ย ย ย ย ย text-transform: uppercase;
ย ย ย ย ย ย letter-spacing: 1px;
ย ย ย ย }

ย ย ย ย .btn:hover {
ย ย ย ย ย ย transform: translateY(-2px);
ย ย ย ย ย ย box-shadow: 0 10px 20px rgba(0,0,0,0.2);
ย ย ย ย }

ย ย ย ย .btn.secondary {
ย ย ย ย ย ย background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
ย ย ย ย }

ย ย ย ย .logo-upload {
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย }

ย ย ย ย .logo-preview {
ย ย ย ย ย ย width: 60px;
ย ย ย ย ย ย height: 60px;
ย ย ย ย ย ย border: 2px dashed #ccc;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย transition: all 0.3s ease;
ย ย ย ย }

ย ย ย ย .logo-preview:hover {
ย ย ย ย ย ย border-color: #4facfe;
ย ย ย ย }

ย ย ย ย .logo-preview img {
ย ย ย ย ย ย max-width: 100%;
ย ย ย ย ย ย max-height: 100%;
ย ย ย ย ย ย object-fit: contain;
ย ย ย ย }

ย ย ย ย .debug-info {
ย ย ย ย ย ย margin-top: 20px;
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย background: #f8f9fa;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย font-family: monospace;
ย ย ย ย ย ย font-size: 12px;
ย ย ย ย ย ย color: #666;
ย ย ย ย ย ย max-height: 200px;
ย ย ย ย ย ย overflow-y: auto;
ย ย ย ย }

ย ย ย ย .status-indicator {
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย margin-bottom: 20px;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย }

ย ย ย ย .status-success {
ย ย ย ย ย ย background: #d4edda;
ย ย ย ย ย ย color: #155724;
ย ย ย ย ย ย border: 1px solid #c3e6cb;
ย ย ย ย }

ย ย ย ย .status-error {
ย ย ย ย ย ย background: #f8d7da;
ย ย ย ย ย ย color: #721c24;
ย ย ย ย ย ย border: 1px solid #f5c6cb;
ย ย ย ย }

ย ย ย ย .status-info {
ย ย ย ย ย ย background: #d1ecf1;
ย ย ย ย ย ย color: #0c5460;
ย ย ย ย ย ย border: 1px solid #bee5eb;
ย ย ย ย }

ย ย ย ย .rounded-options {
ย ย ย ย ย ย display: none;
ย ย ย ย ย ย margin-top: 15px;
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย background: #fff3cd;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย border: 1px solid #ffeaa7;
ย ย ย ย }

ย ย ย ย .rounded-options.show {
ย ย ย ย ย ย display: block;
ย ย ย ย }

ย ย ย ย .rounded-control {
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย }

ย ย ย ย .rounded-control label {
ย ย ย ย ย ย font-size: 14px;
ย ย ย ย ย ย color: #856404;
ย ย ย ย }

ย ย ย ย #dataAnalysis {
ย ย ย ย ย ย font-size: 14px;
ย ย ย ย ย ย color: #495057;
ย ย ย ย ย ย animation: slideDown 0.3s ease-out;
ย ย ย ย }

ย ย ย ย @keyframes slideDown {
ย ย ย ย ย ย from {
ย ย ย ย ย ย ย ย opacity: 0;
ย ย ย ย ย ย ย ย transform: translateY(-10px);
ย ย ย ย ย ย }
ย ย ย ย ย ย to {
ย ย ย ย ย ย ย ย opacity: 1;
ย ย ย ย ย ย ย ย transform: translateY(0);
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย .unicode-indicator {
ย ย ย ย ย ย background: #e8f5e8;
ย ย ย ย ย ย color: #2d5a2d;
ย ย ย ย ย ย padding: 8px 12px;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย ย ย font-size: 13px;
ย ย ย ย ย ย border: 1px solid #c3e6cb;
ย ย ย ย }

ย ย ย ย .custom-gradient-controls {
ย ย ย ย ย ย margin-top: 15px;
ย ย ย ย ย ย padding: 15px;
ย ย ย ย ย ย background: #f8f9fa;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย border: 1px solid #e9ecef;
ย ย ย ย }

ย ย ย ย .gradient-preview {
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย height: 60px;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย border: 2px solid #e9ecef;
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย background: linear-gradient(45deg, #000000, #ff0000);
ย ย ย ย }

ย ย ย ย .gradient-stops {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: 1fr 1fr;
ย ย ย ย ย ย gap: 15px;
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย }

ย ย ย ย .color-stop label {
ย ย ย ย ย ย font-size: 12px;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย color: #495057;
ย ย ย ย }

ย ย ย ย .gradient-direction {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย }

ย ย ย ย .gradient-direction input[type="range"] {
ย ย ย ย ย ย flex: 1;
ย ย ย ย }

ย ย ย ย .logo-controls {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: 1fr 1fr;
ย ย ย ย ย ย gap: 15px;
ย ย ย ย ย ย margin-top: 15px;
ย ย ย ย }

ย ย ย ย .logo-info {
ย ย ย ย ย ย background: #e8f5e8;
ย ย ย ย ย ย padding: 10px;
ย ย ย ย ย ย border-radius: 6px;
ย ย ย ย ย ย font-size: 12px;
ย ย ย ย ย ย color: #2d5a2d;
ย ย ย ย ย ย margin-top: 10px;
ย ย ย ย }

ย ย ย ย .logo-preview-container {
ย ย ย ย ย ย position: relative;
ย ย ย ย ย ย display: inline-block;
ย ย ย ย }

ย ย ย ย .logo-remove {
ย ย ย ย ย ย position: absolute;
ย ย ย ย ย ย top: -8px;
ย ย ย ย ย ย right: -8px;
ย ย ย ย ย ย background: #dc3545;
ย ย ย ย ย ย color: white;
ย ย ย ย ย ย border: none;
ย ย ย ย ย ย border-radius: 50%;
ย ย ย ย ย ย width: 20px;
ย ย ย ย ย ย height: 20px;
ย ย ย ย ย ย font-size: 12px;
ย ย ย ย ย ย cursor: pointer;
ย ย ย ย ย ย display: none;
ย ย ย ย }

ย ย ย ย .logo-preview-container:hover .logo-remove {
ย ย ย ย ย ย display: block;
ย ย ย ย }

ย ย ย ย @media (max-width: 768px) {
ย ย ย ย ย ย .main-content {
ย ย ย ย ย ย ย ย grid-template-columns: 1fr;
ย ย ย ย ย ย ย ย gap: 20px;
ย ย ย ย ย ย ย ย padding: 20px;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .qr-preview {
ย ย ย ย ย ย ย ย width: 300px;
ย ย ย ย ย ย ย ย height: 300px;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย </style>
</head>
<body>
ย ย <div class="container">
ย ย ย ย <div class="header">
ย ย ย ย ย ย <h1>๐จ Advanced QR Designer</h1>
ย ย ย ย ย ย <p>Custom patterns เคเคฐ professional QR codes เคฌเคจเคพเคเค - Hindi Text Fixed! ๐ฎ๐ณ</p>
ย ย ย ย </div>

ย ย ย ย <div class="main-content">
ย ย ย ย ย ย <div class="controls-panel">
ย ย ย ย ย ย ย ย <div id="libraryStatus" class="status-indicator status-info">
ย ย ย ย ย ย ย ย ย ย ๐ Checking QR library status...
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label for="qrText">QR Code Content</label>
ย ย ย ย ย ย ย ย ย ย <textarea id="qrText" placeholder="Enter text, URL, or data... Hindi text fully supported!" rows="3">https://example.com</textarea>
ย ย ย ย ย ย ย ย ย ย <div id="unicodeInfo" class="unicode-indicator" style="display: none;">
ย ย ย ย ย ย ย ย ย ย ย ย <div id="unicodeDetails"></div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div id="dataAnalysis" style="margin-top: 10px; padding: 10px; border-radius: 8px; display: none;">
ย ย ย ย ย ย ย ย ย ย ย ย <div id="dataInfo" style="font-size: 14px; color: #495057; margin-bottom: 8px;"></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div id="patternRecommendation" style="font-size: 14px; font-weight: 600;"></div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label>Dot Pattern Style</label>
ย ย ย ย ย ย ย ย ย ย <div class="style-selector">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option active" data-style="square">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>โฌ</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Square</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option" data-style="circle">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>โซ</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Circle</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option premium" data-style="rounded">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>๐ฅ</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Rounded Pro</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option" data-style="diamond">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>โ</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Diamond</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option" data-style="line">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>โฌ</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Line</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option" data-style="mixed">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>โโโ</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Mixed</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option" data-style="pills">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>๐</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Pills</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option" data-style="mixed-dots">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>โโ</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Mixed Dots</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="style-option" data-style="square-dots">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>โชโช</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Square Dots</small>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย <div id="roundedOptions" class="rounded-options">
ย ย ย ย ย ย ย ย ย ย ย ย <h4 style="color: #856404; margin-bottom: 15px;">๐ฅ Professional Rounded Settings</h4>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="rounded-control">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label for="dotsType">Dots Style</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select id="dotsType">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="rounded">Rounded</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="dots">Dots</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="classy">Classy</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="classy-rounded">Classy Rounded</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="square">Square</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="extra-rounded">Extra Rounded</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย <div class="rounded-control">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label for="cornersType">Corner Style</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select id="cornersType">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="square">Square</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="extra-rounded">Extra Rounded</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="dot">Dot</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย <div class="rounded-control">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label for="cornersDotType">Corner Dot Style</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select id="cornersDotType">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="square">Square</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="dot">Dot</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="rounded">Rounded</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label>Corner Style</label>
ย ย ย ย ย ย ย ย ย ย <div class="corner-styles">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="corner-option active" data-corner="square">โฌ</div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="corner-option" data-corner="circle">โซ</div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="corner-option" data-corner="rounded">โข</div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="corner-option" data-corner="star">โฆ</div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label>Colors</label>
ย ย ย ย ย ย ย ย ย ย <div class="color-controls">
ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label for="foregroundColor">Foreground</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="color" id="foregroundColor" value="#000000">
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label for="backgroundColor">Background</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="color" id="backgroundColor" value="#ffffff">
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label for="gradientType">Gradient Type</label>
ย ย ย ย ย ย ย ย ย ย <select id="gradientType">
ย ย ย ย ย ย ย ย ย ย ย ย <option value="none">No Gradient</option>
ย ย ย ย ย ย ย ย ย ย ย ย <option value="linear">Linear Gradient</option>
ย ย ย ย ย ย ย ย ย ย ย ย <option value="radial">Radial Gradient</option>
ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div id="gradientControls" class="custom-gradient-controls" style="display: none;">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="gradient-preview" id="gradientPreview"></div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="gradient-stops">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="color-stop">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label>Start Color</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="color" id="gradientColor1" value="#000000">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="color-stop">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label>End Color</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="color" id="gradientColor2" value="#ff0000">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="gradient-direction">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label for="gradientAngle">Direction (degrees)</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="range" id="gradientAngle" min="0" max="360" value="45">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="angleValue">45ยฐ</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label for="qrSize">QR Size (px)</label>
ย ย ย ย ย ย ย ย ย ย <input type="range" id="qrSize" min="200" max="800" value="400">
ย ย ย ย ย ย ย ย ย ย <span id="sizeValue">400px</span>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label for="errorLevel">Error Correction</label>
ย ย ย ย ย ย ย ย ย ย <select id="errorLevel">
ย ย ย ย ย ย ย ย ย ย ย ย <option value="L">Low (7%)</option>
ย ย ย ย ย ย ย ย ย ย ย ย <option value="M" selected>Medium (15%)</option>
ย ย ย ย ย ย ย ย ย ย ย ย <option value="Q">Quartile (25%)</option>
ย ย ย ย ย ย ย ย ย ย ย ย <option value="H">High (30%)</option>
ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label>Logo/Image</label>
ย ย ย ย ย ย ย ย ย ย <div class="logo-upload">
ย ย ย ย ย ย ย ย ย ย ย ย <input type="file" id="logoInput" accept="image/*" style="display: none;">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="logo-preview-container">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="logo-preview" onclick="document.getElementById('logoInput').click()">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="logoText">+ Add Logo</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <img id="logoImage" style="display: none;">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="logo-remove" onclick="removeLogo()" title="Remove Logo">ร</button>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div id="logoInfo" class="logo-info" style="display: none;">
ย ย ย ย ย ย ย ย ย ย ย ย <div id="logoDetails"></div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="logo-controls" id="logoControls" style="display: none;">
ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label for="logoSize">Logo Size (%)</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="range" id="logoSize" min="5" max="30" value="15">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span id="logoSizeValue">15%</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label for="logoQuality">Render Quality</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select id="logoQuality">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="standard">Standard</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="high">High Quality</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="ultra">Ultra (4K)</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="control-group">
ย ย ย ย ย ย ย ย ย ย <label for="customText">Custom Text/Branding</label>
ย ย ย ย ย ย ย ย ย ย <input type="text" id="customText" placeholder="Your brand name...">
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>

ย ย ย ย ย ย <div class="preview-panel">
ย ย ย ย ย ย ย ย <div class="qr-preview">
ย ย ย ย ย ย ย ย ย ย <canvas id="qrCanvas"></canvas>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <div class="export-controls">
ย ย ย ย ย ย ย ย ย ย <button class="btn" onclick="generateQR()">๐ Generate QR</button>
ย ย ย ย ย ย ย ย ย ย <button class="btn secondary" onclick="downloadQR()">๐พ Download PNG</button>
ย ย ย ย ย ย ย ย ย ย <button class="btn" onclick="testHindiEncoding()">๐ฎ๐ณ Test Hindi</button>
ย ย ย ย ย ย ย ย ย ย <button class="btn secondary" onclick="debugMode()">๐ Debug Mode</button>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย <div class="debug-info" id="debugInfo">
ย ย ย ย ย ย ย ย ย ย <strong>Debug Console:</strong><br>
ย ย ย ย ย ย ย ย ย ย <div id="debugMessages">System starting up...</div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย <script>
ย ย ย ย function debugLog(message, type = 'info') {
ย ย ย ย ย ย const debugMessages = document.getElementById('debugMessages');
ย ย ย ย ย ย if (!debugMessages) return;
ย ย ย ย ย ยย
ย ย ย ย ย ย const timestamp = new Date().toLocaleTimeString();
ย ย ย ย ย ย const colors = {
ย ย ย ย ย ย ย ย 'info': '#0c5460',
ย ย ย ย ย ย ย ย 'success': '#155724',ย
ย ย ย ย ย ย ย ย 'error': '#721c24',
ย ย ย ย ย ย ย ย 'warning': '#856404'
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย if (debugMessages.children.length > 50) {
ย ย ย ย ย ย ย ย debugMessages.removeChild(debugMessages.firstChild);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย const msgDiv = document.createElement('div');
ย ย ย ย ย ย msgDiv.style.color = colors[type];
ย ย ย ย ย ย msgDiv.style.margin = '2px 0';
ย ย ย ย ย ย msgDiv.textContent = `[${timestamp}] ${message}`;
ย ย ย ย ย ย debugMessages.appendChild(msgDiv);
ย ย ย ย ย ยย
ย ย ย ย ย ย debugMessages.scrollTop = debugMessages.scrollHeight;
ย ย ย ย ย ย console.log(`[QR Debug] ${message}`);
ย ย ย ย }

ย ย ย ย function checkLibraryStatus() {
ย ย ย ย ย ย debugLog('Checking QR libraries...', 'info');
ย ย ย ย ย ยย
ย ย ย ย ย ย let basicLibraryLoaded = typeof qrcode !== 'undefined';
ย ย ย ย ย ย let stylingLibraryLoaded = typeof QRCodeStyling !== 'undefined';
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!basicLibraryLoaded) {
ย ย ย ย ย ย ย ย debugLog('ERROR: Basic qrcode library not found!', 'error');
ย ย ย ย ย ย ย ย updateLibraryStatus('โ Basic QR Library not loaded', 'error');
ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!stylingLibraryLoaded) {
ย ย ย ย ย ย ย ย debugLog('WARNING: QR-Code-Styling library not found!', 'warning');
ย ย ย ย ย ย ย ย updateLibraryStatus('โ๏ธ Loading styling library...', 'info');
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย debugLog('QR-Code-Styling library found!', 'success');
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const testQR = qrcode(0, 'M');
ย ย ย ย ย ย ย ย testQR.addData('test', 'Byte');
ย ย ย ย ย ย ย ย testQR.make();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const moduleCount = testQR.getModuleCount();
ย ย ย ย ย ย ย ย debugLog(`Test QR generated: ${moduleCount}x${moduleCount} modules`, 'success');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย updateLibraryStatus('โ QR Libraries loaded and working', 'success');
ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย debugLog('ERROR testing libraries: ' + error.message, 'error');
ย ย ย ย ย ย ย ย updateLibraryStatus('โ๏ธ QR Libraries loaded but have issues', 'error');
ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function updateLibraryStatus(message, type) {
ย ย ย ย ย ย const statusDiv = document.getElementById('libraryStatus');
ย ย ย ย ย ย statusDiv.textContent = message;
ย ย ย ย ย ย statusDiv.className = `status-indicator status-${type}`;
ย ย ย ย }

ย ย ย ย // Advanced Unicode-aware QR Renderer
ย ย ย ย class UnicodeQRRenderer {
ย ย ย ย ย ย constructor(canvas) {
ย ย ย ย ย ย ย ย this.canvas = canvas;
ย ย ย ย ย ย ย ย this.ctx = canvas.getContext('2d');
ย ย ย ย ย ย ย ย this.settings = {
ย ย ย ย ย ย ย ย ย ย dotStyle: 'square',
ย ย ย ย ย ย ย ย ย ย cornerStyle: 'square',
ย ย ย ย ย ย ย ย ย ย foregroundColor: '#000000',
ย ย ย ย ย ย ย ย ย ย backgroundColor: '#ffffff',
ย ย ย ย ย ย ย ย ย ย gradientType: 'none',
ย ย ย ย ย ย ย ย ย ย size: 400,
ย ย ย ย ย ย ย ย ย ย errorLevel: 'M',
ย ย ย ย ย ย ย ย ย ย logo: null,
ย ย ย ย ย ย ย ย ย ย logoSize: 15,
ย ย ย ย ย ย ย ย ย ย customText: '',
ย ย ย ย ย ย ย ย ย ย dotsType: 'rounded',
ย ย ย ย ย ย ย ย ย ย cornersType: 'square',
ย ย ย ย ย ย ย ย ย ย cornersDotType: 'square'
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย this.qrMatrix = null;
ย ย ย ย ย ย ย ย this.moduleCount = 0;
ย ย ย ย ย ย ย ย this.isLibraryWorking = false;
ย ย ย ย ย ย ย ย this.dataComplexity = null;
ย ย ย ย ย ย }

ย ย ย ย ย ย initialize() {
ย ย ย ย ย ย ย ย debugLog('Initializing Unicode QR Renderer...', 'info');
ย ย ย ย ย ย ย ย this.isLibraryWorking = checkLibraryStatus();
ย ย ย ย ย ย ย ย return this.isLibraryWorking;
ย ย ย ย ย ย }

ย ย ย ย ย ย // Proper Unicode text encoding for QR codes
ย ย ย ย ย ย encodeForQR(text) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย // Convert text to UTF-8 bytes using TextEncoder
ย ย ย ย ย ย ย ย ย ย const encoder = new TextEncoder();
ย ย ย ย ย ย ย ย ย ย const utf8Bytes = encoder.encode(text);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Convert UTF-8 bytes to Latin-1 string for QR library
ย ย ย ย ย ย ย ย ย ย let encodedString = '';
ย ย ย ย ย ย ย ย ย ย for (let i = 0; i < utf8Bytes.length; i++) {
ย ย ย ย ย ย ย ย ย ย ย ย encodedString += String.fromCharCode(utf8Bytes[i]);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย debugLog(`Unicode encoding: ${text.length} chars โ ${utf8Bytes.length} bytes`, 'info');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Verify the encoding works by decoding back
ย ย ย ย ย ย ย ย ย ย const testDecoder = new TextDecoder();
ย ย ย ย ย ย ย ย ย ย const decodedBytes = new Uint8Array(encodedString.length);
ย ย ย ย ย ย ย ย ย ย for (let i = 0; i < encodedString.length; i++) {
ย ย ย ย ย ย ย ย ย ย ย ย decodedBytes[i] = encodedString.charCodeAt(i);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย const decodedText = testDecoder.decode(decodedBytes);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (decodedText === text) {
ย ย ย ย ย ย ย ย ย ย ย ย debugLog('Unicode encoding verification successful!', 'success');
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย debugLog('Unicode encoding verification failed!', 'error');
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย return encodedString;
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Unicode encoding failed: ' + error.message, 'error');
ย ย ย ย ย ย ย ย ย ย return text; // Fallback to original text
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย analyzeData(text) {
ย ย ย ย ย ย ย ย const dataLength = text.length;
ย ย ย ย ย ย ย ย const hasSpecialChars = /[^A-Za-z0-9\s]/.test(text);
ย ย ย ย ย ย ย ย const hasUnicode = /[^\x00-\x7F]/.test(text);
ย ย ย ย ย ย ย ย const hasHindi = /[\u0900-\u097F]/.test(text);
ย ย ย ย ย ย ย ย const hasArabic = /[\u0600-\u06FF]/.test(text);
ย ย ย ย ย ย ย ย const hasEmoji = /[\u{1F600}-\u{1F64F}]|[\u{1F300}-\u{1F5FF}]|[\u{1F680}-\u{1F6FF}]|[\u{1F1E0}-\u{1F1FF}]/u.test(text);
ย ย ย ย ย ย ย ย const isURL = /^https?:\/\//i.test(text);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Calculate actual byte size for Unicode text
ย ย ย ย ย ย ย ย const encoder = new TextEncoder();
ย ย ย ย ย ย ย ย const actualByteSize = encoder.encode(text).length;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย let complexity = 'low';
ย ย ย ย ย ย ย ย let estimatedModules = 21;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Realistic thresholds based on testing - most patterns work up to 450 chars
ย ย ย ย ย ย ย ย if (dataLength < 150) {
ย ย ย ย ย ย ย ย ย ย complexity = 'low';
ย ย ย ย ย ย ย ย ย ย estimatedModules = 21;
ย ย ย ย ย ย ย ย } else if (dataLength < 300) {
ย ย ย ย ย ย ย ย ย ย complexity = 'medium';
ย ย ย ย ย ย ย ย ย ย estimatedModules = 33;
ย ย ย ย ย ย ย ย } else if (dataLength < 450) {
ย ย ย ย ย ย ย ย ย ย complexity = 'high';
ย ย ย ย ย ย ย ย ย ย estimatedModules = 45;
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย complexity = 'very-high';
ย ย ย ย ย ย ย ย ย ย estimatedModules = 57 + Math.floor((dataLength - 450) / 100) * 4;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // For Unicode, only adjust if text is very long
ย ย ย ย ย ย ย ย if (hasUnicode && dataLength > 400) {
ย ย ย ย ย ย ย ย ย ย estimatedModules = Math.min(177, estimatedModules * 1.2);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย ย ย length: dataLength,
ย ย ย ย ย ย ย ย ย ย byteSize: actualByteSize,
ย ย ย ย ย ย ย ย ย ย complexity: complexity,
ย ย ย ย ย ย ย ย ย ย hasSpecialChars: hasSpecialChars,
ย ย ย ย ย ย ย ย ย ย hasUnicode: hasUnicode,
ย ย ย ย ย ย ย ย ย ย hasHindi: hasHindi,
ย ย ย ย ย ย ย ย ย ย hasArabic: hasArabic,
ย ย ย ย ย ย ย ย ย ย hasEmoji: hasEmoji,
ย ย ย ย ย ย ย ย ย ย isURL: isURL,
ย ย ย ย ย ย ย ย ย ย estimatedModules: Math.min(177, estimatedModules),
ย ย ย ย ย ย ย ย ย ย recommendedPatterns: this.getRecommendedPatterns(complexity, dataLength, hasUnicode),
ย ย ย ย ย ย ย ย ย ย warningLevel: this.getWarningLevel(dataLength, estimatedModules, hasUnicode),
ย ย ย ย ย ย ย ย ย ย encoding: hasUnicode ? 'UTF-8' : 'ASCII'
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย }

ย ย ย ย ย ย getRecommendedPatterns(complexity, dataLength, hasUnicode) {
ย ย ย ย ย ย ย ย // Pills pattern has issues after ~350 characters
ย ย ย ย ย ย ย ย const pillsThreshold = 350;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const patterns = {
ย ย ย ย ย ย ย ย ย ย 'low': {
ย ย ย ย ย ย ย ย ย ย ย ย best: ['circle', 'rounded', 'diamond', 'mixed-dots', 'pills'],
ย ย ย ย ย ย ย ย ย ย ย ย good: ['square-dots', 'mixed', 'square'],
ย ย ย ย ย ย ย ย ย ย ย ย acceptable: ['line']
ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย 'medium': {
ย ย ย ย ย ย ย ย ย ย ย ย best: ['square', 'circle', 'rounded', 'diamond'],
ย ย ย ย ย ย ย ย ย ย ย ย good: dataLength < pillsThreshold ? ['pills', 'square-dots', 'mixed-dots'] : ['square-dots', 'mixed-dots'],
ย ย ย ย ย ย ย ย ย ย ย ย acceptable: ['line', 'mixed']
ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย 'high': {
ย ย ย ย ย ย ย ย ย ย ย ย best: ['square', 'circle'],
ย ย ย ย ย ย ย ย ย ย ย ย good: ['rounded', 'square-dots'],
ย ย ย ย ย ย ย ย ย ย ย ย acceptable: dataLength < pillsThreshold ? ['pills'] : []
ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย 'very-high': {
ย ย ย ย ย ย ย ย ย ย ย ย best: ['square'],
ย ย ย ย ย ย ย ย ย ย ย ย good: ['circle'],
ย ย ย ย ย ย ย ย ย ย ย ย acceptable: ['rounded']
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย return patterns[complexity] || patterns['very-high'];
ย ย ย ย ย ย }

ย ย ย ย ย ย getWarningLevel(dataLength, estimatedModules, hasUnicode) {
ย ย ย ย ย ย ย ย // Realistic thresholds based on testing - most patterns work well up to 450 chars
ย ย ย ย ย ย ย ย if (dataLength > 600 || estimatedModules > 120) {
ย ย ย ย ย ย ย ย ย ย return 'critical';
ย ย ย ย ย ย ย ย } else if (dataLength > 450 || estimatedModules > 80) {
ย ย ย ย ย ย ย ย ย ย return 'warning';
ย ย ย ย ย ย ย ย } else if (dataLength > 300 || estimatedModules > 60) {
ย ย ย ย ย ย ย ย ย ย return 'info';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย return 'ok';
ย ย ย ย ย ย }

ย ย ย ย ย ย showDataAnalysis(analysis) {
ย ย ย ย ย ย ย ย const dataAnalysisDiv = document.getElementById('dataAnalysis');
ย ย ย ย ย ย ย ย const dataInfoDiv = document.getElementById('dataInfo');
ย ย ย ย ย ย ย ย const recommendationDiv = document.getElementById('patternRecommendation');
ย ย ย ย ย ย ย ย const unicodeInfoDiv = document.getElementById('unicodeInfo');
ย ย ย ย ย ย ย ย const unicodeDetailsDiv = document.getElementById('unicodeDetails');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย dataAnalysisDiv.style.display = 'block';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Show Unicode information
ย ย ย ย ย ย ย ย if (analysis.hasUnicode) {
ย ย ย ย ย ย ย ย ย ย unicodeInfoDiv.style.display = 'block';
ย ย ย ย ย ย ย ย ย ย let unicodeText = `๐ Encoding: ${analysis.encoding} | Size: ${analysis.byteSize} bytes`;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (analysis.hasHindi) {
ย ย ย ย ย ย ย ย ย ย ย ย unicodeText += ' | ๐ฎ๐ณ Hindi Detected';
ย ย ย ย ย ย ย ย ย ย ย ย unicodeInfoDiv.className = 'unicode-indicator hindi';
ย ย ย ย ย ย ย ย ย ย } else if (analysis.hasArabic) {
ย ย ย ย ย ย ย ย ย ย ย ย unicodeText += ' | ๐ธ๐ฆ Arabic Detected';
ย ย ย ย ย ย ย ย ย ย ย ย unicodeInfoDiv.className = 'unicode-indicator hindi';
ย ย ย ย ย ย ย ย ย ย } else if (analysis.hasEmoji) {
ย ย ย ย ย ย ย ย ย ย ย ย unicodeText += ' | ๐ Emoji Detected';
ย ย ย ย ย ย ย ย ย ย ย ย unicodeInfoDiv.className = 'unicode-indicator';
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย unicodeText += ' | ๐ Unicode Text';
ย ย ย ย ย ย ย ย ย ย ย ย unicodeInfoDiv.className = 'unicode-indicator';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย unicodeDetailsDiv.innerHTML = unicodeText;
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย unicodeInfoDiv.style.display = 'none';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Data info
ย ย ย ย ย ย ย ย let infoHTML = `๐ Data: ${analysis.length} characters`;
ย ย ย ย ย ย ย ย if (analysis.isURL) infoHTML += ' (URL)';
ย ย ย ย ย ย ย ย infoHTML += ` | Complexity: ${analysis.complexity.toUpperCase()}`;
ย ย ย ย ย ย ย ย dataInfoDiv.innerHTML = infoHTML;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Auto-adjust settings for Unicode text
ย ย ย ย ย ย ย ย if (analysis.hasUnicode && ['L'].includes(this.settings.errorLevel)) {
ย ย ย ย ย ย ย ย ย ย this.settings.errorLevel = 'M';
ย ย ย ย ย ย ย ย ย ย document.getElementById('errorLevel').value = 'M';
ย ย ย ย ย ย ย ย ย ย debugLog('Auto-upgraded error correction for Unicode text', 'info');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Pattern recommendations
ย ย ย ย ย ย ย ย let recommendationHTML = '';
ย ย ย ย ย ย ย ย const currentPattern = this.settings.dotStyle;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (analysis.warningLevel === 'critical') {
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.background = '#f8d7da';
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.border = '1px solid #f5c6cb';
ย ย ย ย ย ย ย ย ย ย recommendationHTML = 'โ๏ธ <strong>Critical:</strong> Data too large! Use SQUARE pattern and HIGH error correction.';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (analysis.hasUnicode) {
ย ย ย ย ย ย ย ย ย ย ย ย recommendationHTML += '<br>๐ <strong>Unicode Text:</strong> Consider splitting into smaller QR codes.';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Auto-switch for critical data
ย ย ย ย ย ย ย ย ย ย if (!['square', 'circle'].includes(currentPattern)) {
ย ย ย ย ย ย ย ย ย ย ย ย this.settings.dotStyle = 'square';
ย ย ย ย ย ย ย ย ย ย ย ย this.settings.errorLevel = 'H';
ย ย ย ย ย ย ย ย ย ย ย ย recommendationHTML += '<br>๐ Auto-switched to SQUARE pattern for stability.';
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย document.querySelectorAll('.style-option').forEach(o => o.classList.remove('active'));
ย ย ย ย ย ย ย ย ย ย ย ย document.querySelector('[data-style="square"]').classList.add('active');
ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById('errorLevel').value = 'H';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } else if (analysis.warningLevel === 'warning') {
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.background = '#fff3cd';
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.border = '1px solid #ffeaa7';
ย ย ย ย ย ย ย ย ย ย recommendationHTML = 'โ๏ธ <strong>Warning:</strong> Large data detected. Recommended: ' +ย
ย ย ย ย ย ย ย ย ย ย ย ย analysis.recommendedPatterns.best.map(p => p.toUpperCase()).join(', ');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (analysis.hasUnicode) {
ย ย ย ย ย ย ย ย ย ย ย ย recommendationHTML += '<br>๐ <strong>Unicode Text:</strong> Use MEDIUM or HIGH error correction for better scanning.';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } else if (analysis.warningLevel === 'info') {
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.background = '#d1ecf1';
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.border = '1px solid #bee5eb';
ย ย ย ย ย ย ย ย ย ย recommendationHTML = '๐ก <strong>Tip:</strong> For best scanning, use: ' +ย
ย ย ย ย ย ย ย ย ย ย ย ย analysis.recommendedPatterns.best.map(p => p.toUpperCase()).join(', ');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (analysis.hasUnicode) {
ย ย ย ย ย ย ย ย ย ย ย ย recommendationHTML += '<br>๐ <strong>Unicode Text:</strong> Simple patterns work better.';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.background = '#d4edda';
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.border = '1px solid #c3e6cb';
ย ย ย ย ย ย ย ย ย ย recommendationHTML = 'โ <strong>Great!</strong> ';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (analysis.hasUnicode) {
ย ย ย ย ย ย ย ย ย ย ย ย recommendationHTML += 'Unicode text is optimized. All patterns should work well!';
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย recommendationHTML += 'All patterns will work well. Try creative ones like ROUNDED or PILLS!';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย recommendationDiv.innerHTML = recommendationHTML;
ย ย ย ย ย ย ย ย this.dataComplexity = analysis;
ย ย ย ย ย ย }

ย ย ย ย ย ย generateMatrix(text, errorLevel) {
ย ย ย ย ย ย ย ย if (!this.isLibraryWorking) {
ย ย ย ย ย ย ย ย ย ย debugLog('Cannot generate matrix: library not working', 'error');
ย ย ย ย ย ย ย ย ย ย return null;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย debugLog(`Generating QR for: "${text.substring(0, 50)}${text.length > 50 ? '...' : ''}"`, 'info');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Properly encode Unicode text
ย ย ย ย ย ย ย ย ย ย const encodedText = this.encodeForQR(text);
ย ย ย ย ย ย ย ย ย ย debugLog(`Encoded text length: ${encodedText.length} bytes`, 'info');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย let qr;
ย ย ย ย ย ย ย ย ย ย let attemptedLevels = [errorLevel];
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย ย ย qr = qrcode(0, errorLevel);
ย ย ย ย ย ย ย ย ย ย ย ย qr.addData(encodedText, 'Byte'); // Force Byte mode for Unicode
ย ย ย ย ย ย ย ย ย ย ย ย qr.make();
ย ย ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย ย ย debugLog(`Failed with error level ${errorLevel}, trying fallbacks...`, 'warning');
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย // Try different error levels
ย ย ย ย ย ย ย ย ย ย ย ย const fallbackLevels = ['L', 'M', 'Q', 'H'].filter(l => l !== errorLevel);
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย for (const level of fallbackLevels) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย qr = qrcode(0, level);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย qr.addData(encodedText, 'Byte');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย qr.make();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย attemptedLevels.push(level);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย debugLog(`Success with error level ${level}`, 'success');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.settings.errorLevel = level;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById('errorLevel').value = level;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย } catch (e) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย attemptedLevels.push(level);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย debugLog(`Failed with error level ${level}`, 'warning');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย if (!qr) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย throw new Error(`Data too large for QR encoding. Tried levels: ${attemptedLevels.join(', ')}`);
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.moduleCount = qr.getModuleCount();
ย ย ย ย ย ย ย ย ย ย debugLog(`QR matrix size: ${this.moduleCount}x${this.moduleCount}`, 'success');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const matrix = [];
ย ย ย ย ย ย ย ย ย ย let darkModules = 0;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย for(let row = 0; row < this.moduleCount; row++) {
ย ย ย ย ย ย ย ย ย ย ย ย matrix[row] = [];
ย ย ย ย ย ย ย ย ย ย ย ย for(let col = 0; col < this.moduleCount; col++) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const isDark = qr.isDark(row, col);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย matrix[row][col] = isDark;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (isDark) darkModules++;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย } catch(e) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย debugLog(`Error reading module at (${row}, ${col}): ${e.message}`, 'warning');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย matrix[row][col] = false;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย debugLog(`Matrix generated: ${darkModules} dark modules out of ${this.moduleCount * this.moduleCount}`, 'success');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.qrMatrix = matrix;
ย ย ย ย ย ย ย ย ย ย return matrix;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Matrix generation failed: ' + error.message, 'error');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const dataAnalysisDiv = document.getElementById('dataAnalysis');
ย ย ย ย ย ย ย ย ย ย const recommendationDiv = document.getElementById('patternRecommendation');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.display = 'block';
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.background = '#f8d7da';
ย ย ย ย ย ย ย ย ย ย dataAnalysisDiv.style.border = '1px solid #f5c6cb';
ย ย ย ย ย ย ย ย ย ย recommendationDiv.innerHTML = 'โ <strong>Error:</strong> Data is too large to encode! Please reduce data size or split into multiple QR codes.';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย return null;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย async renderRoundedPattern(text) {
ย ย ย ย ย ย ย ย if (typeof QRCodeStyling === 'undefined') {
ย ย ย ย ย ย ย ย ย ย debugLog('QR-Code-Styling library not available', 'error');
ย ย ย ย ย ย ย ย ย ย return this.renderBasicPattern(text);
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย debugLog('Using QR-Code-Styling library for rounded pattern...', 'info');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Properly encode Unicode text for QR-Code-Styling
ย ย ย ย ย ย ย ย ย ย const encodedText = this.encodeForQR(text);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.canvas.width = this.settings.size;
ย ย ย ย ย ย ย ย ย ย this.canvas.height = this.settings.size;
ย ย ย ย ย ย ย ย ย ย this.ctx.clearRect(0, 0, this.settings.size, this.settings.size);

ย ย ย ย ย ย ย ย ย ย const qrConfig = {
ย ย ย ย ย ย ย ย ย ย ย ย width: this.settings.size,
ย ย ย ย ย ย ย ย ย ย ย ย height: this.settings.size,
ย ย ย ย ย ย ย ย ย ย ย ย type: "canvas",
ย ย ย ย ย ย ย ย ย ย ย ย data: encodedText,
ย ย ย ย ย ย ย ย ย ย ย ย image: this.settings.logo ? this.getImageDataURL() : undefined,
ย ย ย ย ย ย ย ย ย ย ย ย margin: 10,
ย ย ย ย ย ย ย ย ย ย ย ย qrOptions: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย typeNumber: 0,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย mode: "Byte",
ย ย ย ย ย ย ย ย ย ย ย ย ย ย errorCorrectionLevel: this.settings.errorLevel
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย imageOptions: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย hideBackgroundDots: true,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย imageSize: this.settings.logoSize / 100,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย margin: 5,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย crossOrigin: "anonymous"
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย dotsOptions: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย color: this.settings.foregroundColor,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย type: this.settings.dotsType
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย cornersSquareOptions: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย color: this.settings.foregroundColor,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย type: this.settings.cornersType
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย cornersDotOptions: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย color: this.settings.foregroundColor,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย type: this.settings.cornersDotType
ย ย ย ย ย ย ย ย ย ย ย ย },
ย ย ย ย ย ย ย ย ย ย ย ย backgroundOptions: {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย color: this.settings.backgroundColor
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย };

ย ย ย ย ย ย ย ย ย ย if (this.settings.gradientType !== 'none') {
ย ย ย ย ย ย ย ย ย ย ย ย qrConfig.dotsOptions.gradient = this.getStylingGradient();
ย ย ย ย ย ย ย ย ย ย ย ย qrConfig.cornersSquareOptions.gradient = this.getStylingGradient();
ย ย ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย ย ย const qrCodeStyling = new QRCodeStyling(qrConfig);

ย ย ย ย ย ย ย ย ย ย await new Promise((resolve, reject) => {
ย ย ย ย ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const tempDiv = document.createElement('div');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย tempDiv.style.position = 'absolute';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย tempDiv.style.left = '-9999px';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.body.appendChild(tempDiv);
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย qrCodeStyling.append(tempDiv);
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const tempCanvas = tempDiv.querySelector('canvas');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (tempCanvas) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.drawImage(tempCanvas, 0, 0, this.settings.size, this.settings.size);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.renderCustomText(this.settings.customText);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย debugLog('Rounded QR pattern generated successfully!', 'success');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย debugLog('Failed to get canvas from QR-Code-Styling', 'error');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.body.removeChild(tempDiv);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย resolve();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }, 100);
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย debugLog('QR-Code-Styling rendering error: ' + error.message, 'error');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย reject(error);
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย });

ย ย ย ย ย ย ย ย ย ย return true;

ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Rounded pattern generation failed: ' + error.message, 'error');
ย ย ย ย ย ย ย ย ย ย return this.renderBasicPattern(text);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย getStylingGradient() {
ย ย ย ย ย ย ย ย switch(this.settings.gradientType) {
ย ย ย ย ย ย ย ย ย ย case 'linear':
ย ย ย ย ย ย ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย type: 'linear',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย rotation: 0,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย colorStops: [
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย { offset: 0, color: this.settings.foregroundColor },
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย { offset: 1, color: '#4ECDC4' }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ]
ย ย ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย ย ย case 'radial':
ย ย ย ย ย ย ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย type: 'radial',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย colorStops: [
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย { offset: 0, color: this.settings.foregroundColor },
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย { offset: 1, color: '#FF6B6B' }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ]
ย ย ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย ย ย case 'custom':
ย ย ย ย ย ย ย ย ย ย ย ย if (this.settings.customGradient) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย return {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย type: 'linear',
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย rotation: this.settings.customGradient.angle,
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย colorStops: [
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย { offset: 0, color: this.settings.customGradient.color1 },
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย { offset: 1, color: this.settings.customGradient.color2 }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ]
ย ย ย ย ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย return null;
ย ย ย ย ย ย ย ย ย ย default:
ย ย ย ย ย ย ย ย ย ย ย ย return null;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย renderCustomText(text) {
ย ย ย ย ย ย ย ย if(!text) return;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const size = this.settings.size;
ย ย ย ย ย ย ย ย ย ย const fontSize = Math.max(12, size/25);
ย ย ย ย ย ย ย ย ย ย this.ctx.font = `bold ${fontSize}px Arial`;
ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = this.settings.foregroundColor;
ย ย ย ย ย ย ย ย ย ย this.ctx.textAlign = 'center';
ย ย ย ย ย ย ย ย ย ย this.ctx.textBaseline = 'bottom';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.ctx.fillText(text, size/2, size - fontSize/2);
ย ย ย ย ย ย ย ย ย ย debugLog('Custom text rendered: ' + text, 'success');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Text rendering error: ' + error.message, 'warning');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย embedLogo(logo, logoSize) {
ย ย ย ย ย ย ย ย if(!logo) return;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const size = this.settings.size;
ย ย ย ย ย ย ย ย ย ย const quality = this.settings.logoQuality || 'standard';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Adjust logo size based on quality setting
ย ย ย ย ย ย ย ย ย ย let actualLogoSize = logoSize;
ย ย ย ย ย ย ย ย ย ย if (quality === 'high') {
ย ย ย ย ย ย ย ย ย ย ย ย actualLogoSize = Math.min(logoSize * 1.2, 25);
ย ย ย ย ย ย ย ย ย ย } else if (quality === 'ultra') {
ย ย ย ย ย ย ย ย ย ย ย ย actualLogoSize = Math.min(logoSize * 1.5, 30);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const logoPixelSize = (size * actualLogoSize) / 100;
ย ย ย ย ย ย ย ย ย ย const logoX = (size - logoPixelSize) / 2;
ย ย ย ย ย ย ย ย ย ย const logoY = (size - logoPixelSize) / 2;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Create white background circle
ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = this.settings.backgroundColor;
ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย this.ctx.arc(logoX + logoPixelSize/2, logoY + logoPixelSize/2, logoPixelSize/2 + 6, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // For high quality, use better interpolation
ย ย ย ย ย ย ย ย ย ย if (quality === 'high' || quality === 'ultra') {
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.imageSmoothingEnabled = true;
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.imageSmoothingQuality = 'high';
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Clip to circle and draw logo
ย ย ย ย ย ย ย ย ย ย this.ctx.save();
ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย this.ctx.arc(logoX + logoPixelSize/2, logoY + logoPixelSize/2, logoPixelSize/2, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย this.ctx.clip();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.ctx.drawImage(logo, logoX, logoY, logoPixelSize, logoPixelSize);
ย ย ย ย ย ย ย ย ย ย this.ctx.restore();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Reset smoothing
ย ย ย ย ย ย ย ย ย ย this.ctx.imageSmoothingEnabled = true;
ย ย ย ย ย ย ย ย ย ย this.ctx.imageSmoothingQuality = 'medium';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย debugLog(`Logo embedded successfully with ${quality} quality`, 'success');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Logo embedding error: ' + error.message, 'warning');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย getImageDataURL() {
ย ย ย ย ย ย ย ย if (!this.settings.logo) return null;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const tempCanvas = document.createElement('canvas');
ย ย ย ย ย ย ย ย ย ย const tempCtx = tempCanvas.getContext('2d');
ย ย ย ย ย ย ย ย ย ย tempCanvas.width = this.settings.logo.width;
ย ย ย ย ย ย ย ย ย ย tempCanvas.height = this.settings.logo.height;
ย ย ย ย ย ย ย ย ย ย tempCtx.drawImage(this.settings.logo, 0, 0);
ย ย ย ย ย ย ย ย ย ย return tempCanvas.toDataURL();
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Logo conversion failed: ' + error.message, 'warning');
ย ย ย ย ย ย ย ย ย ย return null;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย renderBasicPattern(text) {
ย ย ย ย ย ย ย ย const matrix = this.generateMatrix(text, this.settings.errorLevel);
ย ย ย ย ย ย ย ย if(!matrix) {
ย ย ย ย ย ย ย ย ย ย debugLog('Basic render failed: could not generate matrix', 'error');
ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const size = this.settings.size;
ย ย ย ย ย ย ย ย ย ย const moduleSize = size / this.moduleCount;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.canvas.width = size;
ย ย ย ย ย ย ย ย ย ย this.canvas.height = size;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = this.settings.backgroundColor;
ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(0, 0, size, size);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (moduleSize < 5) {
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.imageSmoothingEnabled = false;
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.imageSmoothingEnabled = true;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Check if pills pattern should be used
ย ย ย ย ย ย ย ย ย ย if (this.settings.dotStyle === 'pills' && this.moduleCount <= 80) {
ย ย ย ย ย ย ย ย ย ย ย ย this.renderPillsPattern(matrix, moduleSize, size);
ย ย ย ย ย ย ย ย ย ย ย ย this.renderCornerSquares(matrix, moduleSize);
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย if(this.settings.logo) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.embedLogo(this.settings.logo, this.settings.logoSize);
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย this.renderCustomText(this.settings.customText);
ย ย ย ย ย ย ย ย ย ย ย ย debugLog('Pills pattern completed successfully!', 'success');
ย ย ย ย ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย let renderedModules = 0;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย for(let row = 0; row < this.moduleCount; row++) {
ย ย ย ย ย ย ย ย ย ย ย ย for(let col = 0; col < this.moduleCount; col++) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if(matrix[row][col]) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const x = col * moduleSize;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const y = row * moduleSize;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย const cornerType = this.isCornerSquare(row, col, this.moduleCount);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย let color = this.settings.foregroundColor;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if(this.settings.gradientType !== 'none' && !cornerType && this.moduleCount <= 80) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย color = this.getGradientColor(row, col, this.moduleCount, this.settings.foregroundColor);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if(cornerType) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if((cornerType === 'top-left' && row === 0 && col === 0) ||
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย(cornerType === 'top-right' && row === 0 && col === this.moduleCount - 7) ||
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย(cornerType === 'bottom-left' && row === this.moduleCount - 7 && col === 0)) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.renderCorner(x, y, moduleSize * 7, this.settings.cornerStyle, this.settings.foregroundColor);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.renderDot(x, y, moduleSize, this.settings.dotStyle, color, row, col);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย renderedModules++;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย debugLog(`Rendered ${renderedModules} data modules successfully`, 'success');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if(this.settings.logo && (this.moduleCount <= 60 || this.settings.errorLevel === 'H')) {
ย ย ย ย ย ย ย ย ย ย ย ย this.embedLogo(this.settings.logo, this.settings.logoSize);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.renderCustomText(this.settings.customText);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย debugLog('Basic QR pattern completed successfully!', 'success');
ย ย ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Basic render process failed: ' + error.message, 'error');
ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย isCornerSquare(row, col, size) {
ย ย ย ย ย ย ย ย const cornerSize = 7;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if(row < cornerSize && col < cornerSize) return 'top-left';
ย ย ย ย ย ย ย ย if(row < cornerSize && col >= size - cornerSize) return 'top-right';
ย ย ย ย ย ย ย ย if(row >= size - cornerSize && col < cornerSize) return 'bottom-left';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย }

ย ย ย ย ย ย getGradientColor(row, col, size, baseColor) {
ย ย ย ย ย ย ย ย const { gradientType } = this.settings;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if(gradientType === 'none') return baseColor;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const normalizedRow = row / size;
ย ย ย ย ย ย ย ย ย ย const normalizedCol = col / size;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if(gradientType === 'linear') {
ย ย ย ย ย ย ย ย ย ย ย ย const color1 = this.settings.gradientColor1 || baseColor;
ย ย ย ย ย ย ย ย ย ย ย ย const color2 = this.settings.gradientColor2 || '#4ECDC4';
ย ย ย ย ย ย ย ย ย ย ย ย const angle = (this.settings.gradientAngle || 45) * Math.PI / 180;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย // Calculate position along gradient line
ย ย ย ย ย ย ย ย ย ย ย ย const x = normalizedCol * Math.cos(angle) + normalizedRow * Math.sin(angle);
ย ย ย ย ย ย ย ย ย ย ย ย const ratio = Math.max(0, Math.min(1, x));
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย return this.interpolateColor(color1, color2, ratio);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย else if(gradientType === 'radial') {
ย ย ย ย ย ย ย ย ย ย ย ย const color1 = this.settings.gradientColor1 || baseColor;
ย ย ย ย ย ย ย ย ย ย ย ย const color2 = this.settings.gradientColor2 || '#FF6B6B';
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย const centerDistance = Math.sqrt(
ย ย ย ย ย ย ย ย ย ย ย ย ย ย Math.pow(normalizedRow - 0.5, 2) +ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย Math.pow(normalizedCol - 0.5, 2)
ย ย ย ย ย ย ย ย ย ย ย ย ) * 1.4;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย return this.interpolateColor(color1, color2, Math.min(centerDistance, 1));
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย return baseColor;
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย return baseColor;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย interpolateColor(color1, color2, ratio) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย if(!color1.startsWith('#') || !color2.startsWith('#')) return color1;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const hex1 = color1.replace('#', '');
ย ย ย ย ย ย ย ย ย ย const hex2 = color2.replace('#', '');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const r1 = parseInt(hex1.substr(0, 2), 16);
ย ย ย ย ย ย ย ย ย ย const g1 = parseInt(hex1.substr(2, 2), 16);
ย ย ย ย ย ย ย ย ย ย const b1 = parseInt(hex1.substr(4, 2), 16);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const r2 = parseInt(hex2.substr(0, 2), 16);
ย ย ย ย ย ย ย ย ย ย const g2 = parseInt(hex2.substr(2, 2), 16);
ย ย ย ย ย ย ย ย ย ย const b2 = parseInt(hex2.substr(4, 2), 16);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const r = Math.round(r1 + (r2 - r1) * ratio);
ย ย ย ย ย ย ย ย ย ย const g = Math.round(g1 + (g2 - g1) * ratio);
ย ย ย ย ย ย ย ย ย ย const b = Math.round(b1 + (b2 - b1) * ratio);
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย return `rgb(${r}, ${g}, ${b})`;
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย return color1;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย renderDot(x, y, size, style, color, row, col) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = color;
ย ย ย ย ย ย ย ย ย ย this.ctx.strokeStyle = color;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (size < 3) {
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x, y, size, size);
ย ย ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย switch(style) {
ย ย ย ย ย ย ย ย ย ย ย ย case 'square':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x, y, size, size);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย case 'circle':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(x + size/2, y + size/2, size/2 * 0.85, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย case 'mixed-dots':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const isSmall = (row + col) % 2 === 0;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const radius = isSmall ? size/2 * 0.6 : size/2 * 0.3;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(x + size/2, y + size/2, radius, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย case 'square-dots':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const dotSize = size * 0.6;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const offset = (size - dotSize) / 2;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x + offset, y + offset, dotSize, dotSize);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย case 'diamond':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (size < 6) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.save();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.translate(x + size/2, y + size/2);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.rotate(Math.PI / 4);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(-size/2 * 0.7, -size/2 * 0.7, size * 0.7, size * 0.7);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.restore();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.moveTo(x + size/2, y - size * 0.1);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.lineTo(x + size * 1.1, y + size/2);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.lineTo(x + size/2, y + size * 1.1);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.lineTo(x - size * 0.1, y + size/2);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.closePath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย case 'line':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x + size * 0.1, y + size * 0.3, size * 0.8, size * 0.4);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;

ย ย ย ย ย ย ย ย ย ย ย ย case 'mixed':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if ((row + col) % 3 === 0) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(x + size/2, y + size/2, size/2 * 0.8, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x + size * 0.1, y + size * 0.1, size * 0.8, size * 0.8);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย default:
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x, y, size, size);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Dot rendering error: ' + error.message, 'warning');
ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x, y, size, size);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย renderCorner(x, y, size, style, color) {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const outerSize = size;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = color;
ย ย ย ย ย ย ย ย ย ย this.ctx.strokeStyle = color;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย switch(style) {
ย ย ย ย ย ย ย ย ย ย ย ย case 'square':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = this.interpolateColor(color, '#4285f4', 0.3);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x, y, outerSize, outerSize);
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = this.settings.backgroundColor;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x + outerSize/7, y + outerSize/7, outerSize * 5/7, outerSize * 5/7);
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = color;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(x + outerSize/2, y + outerSize/2, outerSize * 1.5/7, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย case 'circle':
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = this.interpolateColor(color, '#4285f4', 0.3);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(x + outerSize/2, y + outerSize/2, outerSize/2, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = this.settings.backgroundColor;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(x + outerSize/2, y + outerSize/2, outerSize * 2.5/7, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = color;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(x + outerSize/2, y + outerSize/2, outerSize * 1.5/7, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย default:
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.renderCorner(x, y, size, 'square', color);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Corner rendering error: ' + error.message, 'warning');
ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = color;
ย ย ย ย ย ย ย ย ย ย this.ctx.fillRect(x, y, size, size);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย embedLogo(logo, logoSize) {
ย ย ย ย ย ย ย ย if(!logo) return;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย const size = this.settings.size;
ย ย ย ย ย ย ย ย ย ย const logoPixelSize = (size * logoSize) / 100;
ย ย ย ย ย ย ย ย ย ย const logoX = (size - logoPixelSize) / 2;
ย ย ย ย ย ย ย ย ย ย const logoY = (size - logoPixelSize) / 2;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = this.settings.backgroundColor;
ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย this.ctx.arc(logoX + logoPixelSize/2, logoY + logoPixelSize/2, logoPixelSize/2 + 6, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.ctx.save();
ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย this.ctx.arc(logoX + logoPixelSize/2, logoY + logoPixelSize/2, logoPixelSize/2, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย this.ctx.clip();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย this.ctx.drawImage(logo, logoX, logoY, logoPixelSize, logoPixelSize);
ย ย ย ย ย ย ย ย ย ย this.ctx.restore();
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย debugLog('Logo embedded successfully', 'success');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย ย ย debugLog('Logo embedding error: ' + error.message, 'warning');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย renderPillsPattern(matrix, moduleSize, size) {
ย ย ย ย ย ย ย ย const processedModules = new Set();
ย ย ย ย ย ย ย ย const moduleCount = this.moduleCount;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย debugLog('Starting pills pattern rendering...', 'info');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย let pillsRendered = 0;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Process modules from top-left to bottom-right
ย ย ย ย ย ย ย ย for(let row = 0; row < moduleCount; row++) {
ย ย ย ย ย ย ย ย ย ย for(let col = 0; col < moduleCount; col++) {
ย ย ย ย ย ย ย ย ย ย ย ย const moduleKey = `${row}-${col}`;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย if(matrix[row][col] && !processedModules.has(moduleKey) && !this.isCornerSquare(row, col, moduleCount)) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const shape = this.determineShape(matrix, row, col, moduleCount, processedModules);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย this.renderShape(shape, row, col, moduleSize, processedModules);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย pillsRendered++;
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย debugLog(`Pills pattern completed: ${pillsRendered} shapes rendered`, 'success');
ย ย ย ย ย ย }

ย ย ย ย ย ย             determineShape(matrix, row, col, moduleCount, processedModules) {
                // Check vertical continuity (prefer vertical pills)
                let verticalCount = 1;
                for(let i = row + 1; i < moduleCount && i < row + 6; i++) { // Extended check to 6 modules
                    if(!matrix[i] || !matrix[i][col] || processedModules.has(`${i}-${col}`) || this.isCornerSquare(i, col, moduleCount)) {
                        break;
                    }
                    verticalCount++;
                }
                
                // Check horizontal continuity
                let horizontalCount = 1;
                for(let j = col + 1; j < moduleCount && j < col + 5; j++) { // Extended check to 5 modules
                    if(!matrix[row] || !matrix[row][j] || processedModules.has(`${row}-${j}`) || this.isCornerSquare(row, j, moduleCount)) {
                        break;
                    }
                    horizontalCount++;
                }
                
                // Improved decision logic: better pill formation like image (1)
                if(verticalCount >= 4 && verticalCount > horizontalCount + 1) {
                    return {type: 'vertical-pill', length: Math.min(verticalCount, 5), row, col};
                } else if(horizontalCount >= 3 && horizontalCount >= verticalCount) {
                    return {type: 'horizontal-pill', length: Math.min(horizontalCount, 4), row, col};
                } else if(verticalCount >= 2 && verticalCount > horizontalCount) {
                    return {type: 'vertical-pill', length: Math.min(verticalCount, 3), row, col};
                } else if(horizontalCount >= 2) {
                    return {type: 'horizontal-pill', length: Math.min(horizontalCount, 3), row, col};
                } else {
                    return {type: 'pill-circle', row, col};
                }
            }

ย ย ย ย ย ย renderShape(shape, row, col, moduleSize, processedModules) {
ย ย ย ย ย ย ย ย const x = col * moduleSize;
ย ย ย ย ย ย ย ย const y = row * moduleSize;
ย ย ย ย ย ย ย ย const spacing = 0.1 * moduleSize;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Use gradient colors for pills
ย ย ย ย ย ย ย ย const color1 = this.settings.gradientColor1 || this.settings.foregroundColor;
ย ย ย ย ย ย ย ย const color2 = this.settings.gradientColor2 || '#4ECDC4';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย switch(shape.type) {
ย ย ย ย ย ย ย ย ย ย case 'circle':
ย ย ย ย ย ย ย ย ย ย ย ย const radius = moduleSize * 0.4;
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = color1;
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(x + moduleSize/2, y + moduleSize/2, radius, 0, 2 * Math.PI);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ย processedModules.add(`${row}-${col}`);
ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย case 'vertical-pill':
ย ย ย ย ย ย ย ย ย ย ย ย const pillWidth = moduleSize * 0.8;
ย ย ย ย ย ย ย ย ย ย ย ย const pillHeight = (shape.length * moduleSize) - spacing;
ย ย ย ย ย ย ย ย ย ย ย ย const pillX = x + (moduleSize - pillWidth) / 2;
ย ย ย ย ย ย ย ย ย ย ย ย const pillY = y + spacing/2;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย // Create vertical gradient
ย ย ย ย ย ย ย ย ย ย ย ย const vGradient = this.ctx.createLinearGradient(pillX, pillY, pillX, pillY + pillHeight);
ย ย ย ย ย ย ย ย ย ย ย ย vGradient.addColorStop(0, color1);
ย ย ย ย ย ย ย ย ย ย ย ย vGradient.addColorStop(1, color2);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = vGradient;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย // Draw rounded rectangle manually
ย ย ย ย ย ย ย ย ย ย ย ย const capRadius = pillWidth / 2;
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(pillX + capRadius, pillY + capRadius, capRadius, Math.PI, 0, false);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.lineTo(pillX + pillWidth, pillY + pillHeight - capRadius);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(pillX + capRadius, pillY + pillHeight - capRadius, capRadius, 0, Math.PI, false);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.lineTo(pillX, pillY + capRadius);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.closePath();
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย for(let i = 0; i < shape.length; i++) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย processedModules.add(`${row + i}-${col}`);
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย case 'horizontal-pill':
ย ย ย ย ย ย ย ย ย ย ย ย const hPillHeight = moduleSize * 0.8;
ย ย ย ย ย ย ย ย ย ย ย ย const hPillWidth = (shape.length * moduleSize) - spacing;
ย ย ย ย ย ย ย ย ย ย ย ย const hPillX = x + spacing/2;
ย ย ย ย ย ย ย ย ย ย ย ย const hPillY = y + (moduleSize - hPillHeight) / 2;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย // Create horizontal gradient
ย ย ย ย ย ย ย ย ย ย ย ย const hGradient = this.ctx.createLinearGradient(hPillX, hPillY, hPillX + hPillWidth, hPillY);
ย ย ย ย ย ย ย ย ย ย ย ย hGradient.addColorStop(0, color1);
ย ย ย ย ย ย ย ย ย ย ย ย hGradient.addColorStop(1, color2);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fillStyle = hGradient;
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย const hCapRadius = hPillHeight / 2;
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.beginPath();
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(hPillX + hCapRadius, hPillY + hCapRadius, hCapRadius, Math.PI/2, -Math.PI/2, false);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.lineTo(hPillX + hPillWidth - hCapRadius, hPillY);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.arc(hPillX + hPillWidth - hCapRadius, hPillY + hCapRadius, hCapRadius, -Math.PI/2, Math.PI/2, false);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.lineTo(hPillX + hCapRadius, hPillY + hPillHeight);
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.closePath();
ย ย ย ย ย ย ย ย ย ย ย ย this.ctx.fill();
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย for(let j = 0; j < shape.length; j++) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย processedModules.add(`${row}-${col + j}`);
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย break;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย renderCornerSquares(matrix, moduleSize) {
ย ย ย ย ย ย ย ย const moduleCount = this.moduleCount;
ย ย ย ย ย ย ย ย const cornerPositions = [
ย ย ย ย ย ย ย ย ย ย { startRow: 0, startCol: 0 }, // Top-left
ย ย ย ย ย ย ย ย ย ย { startRow: 0, startCol: moduleCount - 7 }, // Top-rightยย
ย ย ย ย ย ย ย ย ย ย { startRow: moduleCount - 7, startCol: 0 }ย // Bottom-left
ย ย ย ย ย ย ย ย ];
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย cornerPositions.forEach(pos => {
ย ย ย ย ย ย ย ย ย ย const x = pos.startCol * moduleSize;
ย ย ย ย ย ย ย ย ย ย const y = pos.startRow * moduleSize;
ย ย ย ย ย ย ย ย ย ย this.renderCorner(x, y, moduleSize * 7, this.settings.cornerStyle, this.settings.foregroundColor);
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย }

ย ย ย ย ย ย async render(text) {
ย ย ย ย ย ย ย ย if (!this.isLibraryWorking) {
ย ย ย ย ย ย ย ย ย ย debugLog('Cannot render: library not initialized', 'error');
ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย }

ย ย ย ย ย ย ย ย debugLog('Starting Unicode QR render process...', 'info');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Analyze data before rendering
ย ย ย ย ย ย ย ย const analysis = this.analyzeData(text);
ย ย ย ย ย ย ย ย this.showDataAnalysis(analysis);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // For very large data, force simple patterns
ย ย ย ย ย ย ย ย if (analysis.warningLevel === 'critical' && !['square', 'circle'].includes(this.settings.dotStyle)) {
ย ย ย ย ย ย ย ย ย ย debugLog('Forcing simple pattern for large data', 'warning');
ย ย ย ย ย ย ย ย ย ย this.settings.dotStyle = 'square';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Use appropriate renderer
ย ย ย ย ย ย ย ย if (this.settings.dotStyle === 'rounded' && analysis.estimatedModules < 60) {
ย ย ย ย ย ย ย ย ย ย return await this.renderRoundedPattern(text);
ย ย ย ย ย ย ย ย } else if (this.settings.dotStyle === 'rounded' && analysis.estimatedModules >= 60) {
ย ย ย ย ย ย ย ย ย ย debugLog('Data too large for rounded pattern, falling back to square', 'warning');
ย ย ย ย ย ย ย ย ย ย this.settings.dotStyle = 'square';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย document.querySelectorAll('.style-option').forEach(o => o.classList.remove('active'));
ย ย ย ย ย ย ย ย ย ย document.querySelector('[data-style="square"]').classList.add('active');
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย return this.renderBasicPattern(text);
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย return this.renderBasicPattern(text);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }

ย ย ย ย ย ย updateSettings(newSettings) {
ย ย ย ย ย ย ย ย this.settings = { ...this.settings, ...newSettings };
ย ย ย ย ย ย ย ย debugLog('Settings updated: ' + Object.keys(newSettings).join(', '), 'info');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย let renderer;
ย ย ย ยย
ย ย ย ย function initializeSystem() {
ย ย ย ย ย ย debugLog('Page loaded, initializing Unicode QR system...', 'info');
ย ย ย ย ย ยย
ย ย ย ย ย ย const canvas = document.getElementById('qrCanvas');
ย ย ย ย ย ย if (!canvas) {
ย ย ย ย ย ย ย ย debugLog('Canvas element not found!', 'error');
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย renderer = new UnicodeQRRenderer(canvas);
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!renderer.initialize()) {
ย ย ย ย ย ย ย ย debugLog('System initialization failed!', 'error');
ย ย ย ย ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย ย ย ย ย if (renderer.initialize()) {
ย ย ย ย ย ย ย ย ย ย ย ย debugLog('Fallback initialization successful!', 'success');
ย ย ย ย ย ย ย ย ย ย ย ย setupEventListeners();
ย ย ย ย ย ย ย ย ย ย ย ย setTimeout(generateQR, 100);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }, 1000);
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย setupEventListeners();
ย ย ย ย ย ยย
ย ย ย ย ย ย debugLog('Unicode QR system ready!', 'success');
ย ย ย ย ย ย setTimeout(generateQR, 100);
ย ย ย ย }

ย ย ย ย function setupEventListeners() {
ย ย ย ย ย ย debugLog('Setting up event listeners...', 'info');
ย ย ย ย ย ยย
ย ย ย ย ย ย // Style option listeners
ย ย ย ย ย ย document.querySelectorAll('.style-option').forEach(option => {
ย ย ย ย ย ย ย ย option.addEventListener('click', function() {
ย ย ย ย ย ย ย ย ย ย const selectedPattern = this.dataset.style;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย document.querySelectorAll('.style-option').forEach(o => o.classList.remove('active'));
ย ย ย ย ย ย ย ย ย ย this.classList.add('active');
ย ย ย ย ย ย ย ย ย ย renderer.updateSettings({ dotStyle: selectedPattern });
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const roundedOptions = document.getElementById('roundedOptions');
ย ย ย ย ย ย ย ย ย ย if (selectedPattern === 'rounded') {
ย ย ย ย ย ย ย ย ย ย ย ย roundedOptions.classList.add('show');
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย roundedOptions.classList.remove('show');
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย });

ย ย ย ย ย ย // Rounded pattern controls
ย ย ย ย ย ย document.getElementById('dotsType').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ dotsType: this.value });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('cornersType').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ cornersType: this.value });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('cornersDotType').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ cornersDotType: this.value });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย // Corner style listeners
ย ย ย ย ย ย document.querySelectorAll('.corner-option').forEach(option => {
ย ย ย ย ย ย ย ย option.addEventListener('click', function() {
ย ย ย ย ย ย ย ย ย ย document.querySelectorAll('.corner-option').forEach(o => o.classList.remove('active'));
ย ย ย ย ย ย ย ย ย ย this.classList.add('active');
ย ย ย ย ย ย ย ย ย ย renderer.updateSettings({ cornerStyle: this.dataset.corner });
ย ย ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย });

ย ย ย ย ย ย // Color controls
ย ย ย ย ย ย document.getElementById('foregroundColor').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ foregroundColor: this.value });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('backgroundColor').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ backgroundColor: this.value });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('gradientType').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ gradientType: this.value });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const gradientControls = document.getElementById('gradientControls');
ย ย ย ย ย ย ย ย if (this.value !== 'none') {
ย ย ย ย ย ย ย ย ย ย gradientControls.style.display = 'block';
ย ย ย ย ย ย ย ย ย ย updateGradientPreview();
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย gradientControls.style.display = 'none';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย // Custom gradient controls
ย ย ย ย ย ย document.getElementById('gradientColor1').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ gradientColor1: this.value });
ย ย ย ย ย ย ย ย updateGradientPreview();
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('gradientColor2').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ gradientColor2: this.value });
ย ย ย ย ย ย ย ย updateGradientPreview();
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('gradientAngle').addEventListener('input', function() {
ย ย ย ย ย ย ย ย const angle = parseInt(this.value);
ย ย ย ย ย ย ย ย renderer.updateSettings({ gradientAngle: angle });
ย ย ย ย ย ย ย ย document.getElementById('angleValue').textContent = angle + 'ยฐ';
ย ย ย ย ย ย ย ย updateGradientPreview();
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('qrSize').addEventListener('input', function() {
ย ย ย ย ย ย ย ย const size = parseInt(this.value);
ย ย ย ย ย ย ย ย document.getElementById('sizeValue').textContent = size + 'px';
ย ย ย ย ย ย ย ย renderer.updateSettings({ size: size });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('errorLevel').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ errorLevel: this.value });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('logoInput').addEventListener('change', function(e) {
ย ย ย ย ย ย ย ย const file = e.target.files[0];
ย ย ย ย ย ย ย ย if(file && file.type.startsWith('image/')) {
ย ย ย ย ย ย ย ย ย ย // Check file size (max 5MB)
ย ย ย ย ย ย ย ย ย ย if (file.size > 5 * 1024 * 1024) {
ย ย ย ย ย ย ย ย ย ย ย ย alert('Logo file too large! Please use a file smaller than 5MB.');
ย ย ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const reader = new FileReader();
ย ย ย ย ย ย ย ย ย ย reader.onload = function(event) {
ย ย ย ย ย ย ย ย ย ย ย ย const img = new Image();
ย ย ย ย ย ย ย ย ย ย ย ย img.onload = function() {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย // Store image
ย ย ย ย ย ย ย ย ย ย ย ย ย ย renderer.updateSettings({ logo: img });
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย // Update UI
ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById('logoImage').src = event.target.result;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById('logoImage').style.display = 'block';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById('logoText').style.display = 'none';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย document.getElementById('logoControls').style.display = 'grid';
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย // Show logo info
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const logoInfo = document.getElementById('logoInfo');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย const logoDetails = document.getElementById('logoDetails');
ย ย ย ย ย ย ย ย ย ย ย ย ย ย logoInfo.style.display = 'block';
ย ย ย ย ย ย ย ย ย ย ย ย ย ย logoDetails.innerHTML = `๐ ${file.name}<br>๐ ${img.width}ร${img.height}px<br>๐พ ${(file.size/1024).toFixed(1)}KB`;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย ย ย ย ย img.src = event.target.result;
ย ย ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ย ย ย reader.readAsDataURL(file);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('logoSize').addEventListener('input', function() {
ย ย ย ย ย ย ย ย const size = parseInt(this.value);
ย ย ย ย ย ย ย ย document.getElementById('logoSizeValue').textContent = size + '%';
ย ย ย ย ย ย ย ย renderer.updateSettings({ logoSize: size });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('logoQuality').addEventListener('change', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ logoQuality: this.value });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('customText').addEventListener('input', function() {
ย ย ย ย ย ย ย ย renderer.updateSettings({ customText: this.value });
ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย });

ย ย ย ย ย ย document.getElementById('qrText').addEventListener('input', function() {
ย ย ย ย ย ย ย ย clearTimeout(window.qrTextTimeout);
ย ย ย ย ย ย ย ย window.qrTextTimeout = setTimeout(() => {
ย ย ย ย ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย ย ย }, 300);
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย debugLog('Event listeners setup complete', 'success');
ย ย ย ย }

ย ย ย ย async function generateQR() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const textInput = document.getElementById('qrText');
ย ย ย ย ย ย ย ย const text = textInput.value.trim();
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if(!text) {
ย ย ย ย ย ย ย ย ย ย debugLog('No text provided, using default', 'warning');
ย ย ย ย ย ย ย ย ย ย textInput.value = 'https://example.com';
ย ย ย ย ย ย ย ย ย ย return generateQR();
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if(!renderer) {
ย ย ย ย ย ย ย ย ย ย debugLog('Renderer not initialized yet', 'error');
ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย debugLog(`Generating QR for: "${text}"`, 'info');
ย ย ย ย ย ย ย ย const success = await renderer.render(text);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if(!success) {
ย ย ย ย ย ย ย ย ย ย debugLog('QR generation failed!', 'error');
ย ย ย ย ย ย ย ย ย ย showFallbackPattern();
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย debugLog('Generate QR error: ' + error.message, 'error');
ย ย ย ย ย ย ย ย showFallbackPattern();
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function updateGradientPreview() {
ย ย ย ย ย ย const color1 = document.getElementById('gradientColor1').value;
ย ย ย ย ย ย const color2 = document.getElementById('gradientColor2').value;
ย ย ย ย ย ย const angle = parseInt(document.getElementById('gradientAngle').value);
ย ย ย ย ย ย const gradientType = document.getElementById('gradientType').value;
ย ย ย ย ย ยย
ย ย ย ย ย ย const preview = document.getElementById('gradientPreview');
ย ย ย ย ย ยย
ย ย ย ย ย ย if (gradientType === 'linear') {
ย ย ย ย ย ย ย ย preview.style.background = `linear-gradient(${angle}deg, ${color1}, ${color2})`;
ย ย ย ย ย ย } else if (gradientType === 'radial') {
ย ย ย ย ย ย ย ย preview.style.background = `radial-gradient(circle, ${color1}, ${color2})`;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function removeLogo() {
ย ย ย ย ย ย renderer.updateSettings({ logo: null, logoOriginal: null });
ย ย ย ย ย ยย
ย ย ย ย ย ย // Reset UI
ย ย ย ย ย ย document.getElementById('logoImage').style.display = 'none';
ย ย ย ย ย ย document.getElementById('logoText').style.display = 'block';
ย ย ย ย ย ย document.getElementById('logoControls').style.display = 'none';
ย ย ย ย ย ย document.getElementById('logoInfo').style.display = 'none';
ย ย ย ย ย ย document.getElementById('logoInput').value = '';
ย ย ย ย ย ยย
ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย debugLog('Logo removed successfully', 'info');
ย ย ย ย }

ย ย ย ย function testHindiEncoding() {
ย ย ย ย ย ย const hindiText = '3.6 เคฎเคฟเคฒเคฟเคฏเคจ (2023): GetLatka เคเฅ เคเคจเฅเคธเคพเคฐ, QR TIGER เคจเฅ 2023 เคฎเฅเค $3.6 เคฎเคฟเคฒเคฟเคฏเคจ เคเคพ เคฐเคพเคเคธเฅเคต เคเคฐเฅเคเคฟเคค เคเคฟเคฏเคพเฅค';
ย ย ย ย ย ย document.getElementById('qrText').value = hindiText;
ย ย ย ย ย ย generateQR();
ย ย ย ย ย ย debugLog('Testing Hindi encoding with sample text', 'info');
ย ย ย ย }

ย ย ย ย function showFallbackPattern() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const canvas = document.getElementById('qrCanvas');
ย ย ย ย ย ย ย ย const ctx = canvas.getContext('2d');
ย ย ย ย ย ย ย ย canvas.width = 400;
ย ย ย ย ย ย ย ย canvas.height = 400;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ctx.fillStyle = '#f0f0f0';
ย ย ย ย ย ย ย ย ctx.fillRect(0, 0, 400, 400);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ctx.fillStyle = '#000000';
ย ย ย ย ย ย ย ย ctx.font = '16px Arial';
ย ย ย ย ย ย ย ย ctx.textAlign = 'center';
ย ย ย ย ย ย ย ย ctx.fillText('QR Generation Error', 200, 190);
ย ย ย ย ย ย ย ย ctx.fillText('Check Debug Console', 200, 210);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย debugLog('Emergency fallback pattern displayed', 'info');
ย ย ย ย ย ย } catch(e) {
ย ย ย ย ย ย ย ย debugLog('Emergency fallback also failed: ' + e.message, 'error');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function downloadQR() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const canvas = document.getElementById('qrCanvas');
ย ย ย ย ย ย ย ย const link = document.createElement('a');
ย ย ย ย ย ย ย ย link.download = 'unicode-qr-code.png';
ย ย ย ย ย ย ย ย link.href = canvas.toDataURL('image/png', 1.0);
ย ย ย ย ย ย ย ย link.click();
ย ย ย ย ย ย ย ย debugLog('Unicode QR code downloaded successfully', 'success');
ย ย ย ย ย ย } catch(error) {
ย ย ย ย ย ย ย ย debugLog('Download failed: ' + error.message, 'error');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function debugMode() {
ย ย ย ย ย ย const debugDiv = document.getElementById('debugInfo');
ย ย ย ย ย ย if (debugDiv.style.maxHeight === 'none') {
ย ย ย ย ย ย ย ย debugDiv.style.maxHeight = '200px';
ย ย ย ย ย ย ย ย debugLog('Debug mode: compact view', 'info');
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย debugDiv.style.maxHeight = 'none';
ย ย ย ย ย ย ย ย debugLog('Debug mode: expanded view', 'info');
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // Initialize when page loads
ย ย ย ย if (document.readyState === 'loading') {
ย ย ย ย ย ย document.addEventListener('DOMContentLoaded', initializeSystem);
ย ย ย ย } else {
ย ย ย ย ย ย initializeSystem();
ย ย ย ย }
ย ย </script>
</body>
</html>